<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É | PLAYLAND</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #ffffff);
            min-height: 100vh;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo img {
            max-width: 120px;
            height: auto;
        }
        h1 {
            text-align: center;
            color: var(--tg-theme-text-color, #ffffff);
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: var(--tg-theme-hint-color, #aaaaaa);
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #ffffff);
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #444444);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #2a2a2a);
            color: var(--tg-theme-text-color, #ffffff);
            box-sizing: border-box;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #0088cc);
        }
        .char-count {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #aaaaaa);
            text-align: right;
            margin-top: 4px;
        }
        .help-text {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #aaaaaa);
            margin-top: 4px;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: 500;
        }
        .status.success { 
            background: rgba(40, 167, 69, 0.2); 
            color: #28a745; 
            border: 1px solid #28a745;
        }
        .status.error { 
            background: rgba(220, 53, 69, 0.2); 
            color: #dc3545; 
            border: 1px solid #dc3545;
        }
        .status.info { 
            background: rgba(23, 162, 184, 0.2); 
            color: #17a2b8; 
            border: 1px solid #17a2b8;
        }
        .debug {
            background: rgba(108, 117, 125, 0.1);
            border: 1px solid var(--tg-theme-hint-color, #444444);
            padding: 10px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 11px;
            max-height: 150px;
            overflow-y: auto;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <img src="images/playland_logo.png" alt="PLAYLAND" onerror="this.style.display='none'">
        </div>
        
        <h1>üéÆ PLAYLAND</h1>
        <p class="subtitle">–ü–æ–¥–∞–π –∑–∞—è–≤–∫—É –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—é!</p>
        
        <div id="status" class="status info">
            üì± –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp...
        </div>
        
        <form id="applicationForm">
            <div class="form-group">
                <label for="nickname">üìù –ù–∏–∫–Ω–µ–π–º:</label>
                <input type="text" id="nickname" name="nickname" required 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º" 
                       pattern="[a-zA-Z0-9_]{3,16}"
                       maxlength="16">
                <div class="help-text">–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª _. –û—Ç 3 –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤.</div>
            </div>
            
            <div class="form-group">
                <label for="discord">üéÆ Discord-–∞–∫–∫–∞—É–Ω—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                <input type="text" id="discord" name="discord" 
                       placeholder="username#1234 –∏–ª–∏ username"
                       maxlength="32">
                <div class="help-text">–ú–∞–∫—Å–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞</div>
            </div>
            
            <div class="form-group">
                <label for="reason">üí¨ –ü–æ—á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                <textarea id="reason" name="reason" rows="4" 
                          placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ, —Å–≤–æ–µ–º –æ–ø—ã—Ç–µ –≤ Minecraft, —á—Ç–æ –≤–∞—Å –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤ –Ω–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ..."
                          maxlength="500"></textarea>
                <div class="char-count" id="charCount">0/500 —Å–∏–º–≤–æ–ª–æ–≤</div>
            </div>
        </form>
        
        <div class="debug" id="debug">
            <strong>üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
            <div id="debugInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let isWebAppReady = false;
        let formData = {};
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[WebApp ${timestamp}]`, message);
            
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo) {
                debugInfo.innerHTML += `${timestamp}: ${message}<br>`;
                debugInfo.scrollTop = debugInfo.scrollHeight;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            if (status) {
                status.textContent = message;
                status.className = 'status ' + type;
            }
            log(`Status [${type}]: ${message}`);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
        log(`üì± User Agent: ${navigator.userAgent}`);
        log(`üåê URL: ${window.location.href}`);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram WebApp
        if (typeof Telegram === 'undefined') {
            log('‚ùå Telegram –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            updateStatus('‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞', 'error');
        } else {
            log('‚úÖ Telegram –æ–±—ä–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω');
            
            if (!Telegram.WebApp) {
                log('‚ùå Telegram.WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                updateStatus('‚ùå WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            } else {
                log('‚úÖ Telegram.WebApp –¥–æ—Å—Ç—É–ø–µ–Ω');
                log(`üìä WebApp –≤–µ—Ä—Å–∏—è: ${Telegram.WebApp.version}`);
                log(`üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${Telegram.WebApp.platform}`);
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = Telegram.WebApp.initDataUnsafe?.user;
                if (user) {
                    log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name} (ID: ${user.id})`);
                } else {
                    log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
                }
                
                // –ö–†–ò–¢–ò–ß–ù–û: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebApp
                try {
                    Telegram.WebApp.ready();
                    isWebAppReady = true;
                    log('‚úÖ Telegram.WebApp.ready() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥
                    Telegram.WebApp.expand();
                    log('‚úÖ WebApp —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω');
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º MainButton
                    Telegram.WebApp.MainButton.text = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É";
                    Telegram.WebApp.MainButton.color = "#0088cc";
                    Telegram.WebApp.MainButton.textColor = "#ffffff";
                    Telegram.WebApp.MainButton.show();
                    log('‚úÖ MainButton –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø–æ–∫–∞–∑–∞–Ω');
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ MainButton
                    Telegram.WebApp.MainButton.onClick(function() {
                        log('üîò MainButton –Ω–∞–∂–∞—Ç');
                        submitApplication();
                    });
                    
                    updateStatus('‚úÖ –ì–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'success');
                    
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WebApp: ${error.message}`);
                    updateStatus('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
                }
            }
        }
        
        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –ø–æ–ª—è –ø—Ä–∏—á–∏–Ω—ã
        document.getElementById('reason').addEventListener('input', function() {
            const count = this.value.length;
            const charCountElement = document.getElementById('charCount');
            if (charCountElement) {
                charCountElement.textContent = `${count}/500 —Å–∏–º–≤–æ–ª–æ–≤`;
                
                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É
                if (count > 450) {
                    charCountElement.style.color = '#dc3545';
                } else if (count > 400) {
                    charCountElement.style.color = '#ffc107';
                } else {
                    charCountElement.style.color = 'var(--tg-theme-hint-color, #aaaaaa)';
                }
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        function validateForm() {
            const nickname = document.getElementById('nickname').value.trim();
            const discord = document.getElementById('discord').value.trim();
            const reason = document.getElementById('reason').value.trim();
            
            log('üîç –ù–∞—á–∏–Ω–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º—ã');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∫–Ω–µ–π–º–∞
            if (!nickname) {
                updateStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º', 'error');
                log('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—É—Å—Ç–æ–π –Ω–∏–∫–Ω–µ–π–º');
                return null;
            }
            
            if (nickname.length < 3 || nickname.length > 16) {
                updateStatus('‚ùå –ù–∏–∫–Ω–µ–π–º: –æ—Ç 3 –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                log(`‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞ (${nickname.length})`);
                return null;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(nickname)) {
                updateStatus('‚ùå –ù–∏–∫–Ω–µ–π–º: —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _', 'error');
                log('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∏–∫–Ω–µ–π–º–µ');
                return null;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Discord (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
            if (discord && discord.length > 32) {
                updateStatus('‚ùå Discord: –º–∞–∫—Å–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞', 'error');
                log(`‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è: Discord —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (${discord.length})`);
                return null;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—á–∏–Ω—ã (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
            if (reason && reason.length > 500) {
                updateStatus('‚ùå –ü—Ä–∏—á–∏–Ω–∞: –º–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                log(`‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–∏—á–∏–Ω–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è (${reason.length})`);
                return null;
            }
            
            const data = {
                nickname: nickname,
                discord: discord || '',
                reason: reason || ''
            };
            
            log('‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
            return data;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
        function submitApplication() {
            log('üì§ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞—è–≤–∫–∏');
            
            if (!isWebAppReady) {
                log('‚ùå WebApp –Ω–µ –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ');
                updateStatus('‚ùå WebApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                return;
            }
            
            // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            const data = validateForm();
            if (!data) {
                log('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞');
                return;
            }
            
            try {
                // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JSON
                const jsonData = JSON.stringify(data);
                log(`üì¶ –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏: ${jsonData}`);
                log(`üìè –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: ${jsonData.length} —Å–∏–º–≤–æ–ª–æ–≤`);
                
                updateStatus('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫—É...', 'info');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Telegram WebApp API
                if (Telegram.WebApp && Telegram.WebApp.sendData) {
                    Telegram.WebApp.sendData(jsonData);
                    log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ Telegram.WebApp.sendData()');
                    updateStatus('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º MainButton –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                    Telegram.WebApp.MainButton.hide();
                    log('‚úÖ MainButton —Å–∫—Ä—ã—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏');
                    
                } else {
                    throw new Error('Telegram.WebApp.sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${error.message}`);
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // Fallback: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—ã—á–Ω–æ–π —Ñ–æ—Ä–º—ã
        document.getElementById('applicationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            log('üìù –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ submit event (fallback)');
            submitApplication();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
        document.getElementById('nickname').addEventListener('input', function() {
            const value = this.value;
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
            this.value = value.replace(/[^a-zA-Z0-9_]/g, '');
        });
        
        // –õ–æ–≥–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç–∞
        log('‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
        log('üéØ –°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            document.getElementById('debug').classList.remove('hidden');
        }
    </script>
</body>
</html>
