<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê WebApp | PLAYLAND</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
            margin: 0;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        .section {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #28a745; color: white; }
        .error { background: #dc3545; color: white; }
        .info { background: #17a2b8; color: white; }
        .warning { background: #ffc107; color: black; }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: white;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            width: 100%;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        h1, h2, h3 { color: #ffcc00; }
        .test-data {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê WEBAPP PLAYLAND</h1>
        
        <div class="section">
            <h3>üìä –°—Ç–∞—Ç—É—Å WebApp</h3>
            <div id="webappStatus" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        </div>
        
        <div class="section">
            <h3>üìù –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞</h3>
            <form id="testForm">
                <label>–ù–∏–∫–Ω–µ–π–º:</label>
                <input type="text" id="nickname" value="TestUser123">
                
                <label>Discord:</label>
                <input type="text" id="discord" value="testuser#1234">
                
                <label>–ü—Ä–∏—á–∏–Ω–∞:</label>
                <textarea id="reason">–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ WebApp</textarea>
                
                <button type="button" onclick="testSendData()">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ sendData</button>
                <button type="button" onclick="testMainButton()">üîò –¢–µ—Å—Ç MainButton</button>
                <button type="button" onclick="showDebugInfo()">üîç –ü–æ–∫–∞–∑–∞—Ç—å debug info</button>
            </form>
        </div>
        
        <div class="section">
            <h3>üìã –õ–æ–≥ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h3>
            <div id="log" class="log"></div>
            <button type="button" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div class="section">
            <h3>üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <div id="testData" class="test-data"></div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let logCount = 0;
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            logCount++;
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#44ff44' : '#44ffff';
            logDiv.innerHTML += `[${logCount}] [${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[WebApp ${timestamp}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logCount = 0;
        }
        
        function updateStatus(message, type) {
            const status = document.getElementById('webappStatus');
            status.textContent = message;
            status.className = 'status ' + type;
        }
        
        function showTestData() {
            const data = {
                nickname: document.getElementById('nickname').value,
                discord: document.getElementById('discord').value,
                reason: document.getElementById('reason').value,
                timestamp: new Date().toISOString(),
                debug: true
            };
            
            document.getElementById('testData').innerHTML = 
                `<strong>JSON –¥–∞–Ω–Ω—ã–µ:</strong><br>${JSON.stringify(data, null, 2)}`;
            
            return data;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('üöÄ –°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω');
        log(`üì± User Agent: ${navigator.userAgent}`);
        log(`üåê URL: ${window.location.href}`);
        log(`üìä –†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞: ${window.innerWidth}x${window.innerHeight}`);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp
        if (typeof Telegram === 'undefined') {
            log('‚ùå Telegram –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            updateStatus('‚ùå Telegram –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
        } else {
            log('‚úÖ Telegram –æ–±—ä–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
            
            if (!Telegram.WebApp) {
                log('‚ùå Telegram.WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                updateStatus('‚ùå WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            } else {
                log('‚úÖ Telegram.WebApp –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                log(`üìä WebApp –≤–µ—Ä—Å–∏—è: ${Telegram.WebApp.version}`);
                log(`üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${Telegram.WebApp.platform}`);
                log(`üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: ${Telegram.WebApp.colorScheme}`);
                log(`üìè –í—ã—Å–æ—Ç–∞ viewport: ${Telegram.WebApp.viewportHeight}`);
                log(`üîí –í—ã—Å–æ—Ç–∞ viewport —Å—Ç–∞–±–∏–ª—å–Ω–∞—è: ${Telegram.WebApp.viewportStableHeight}`);
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = Telegram.WebApp.initDataUnsafe?.user;
                if (user) {
                    log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name} (ID: ${user.id})`, 'success');
                    log(`üîë Username: ${user.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                    log(`üåê –Ø–∑—ã–∫: ${user.language_code || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                } else {
                    log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', 'warning');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º initData
                if (Telegram.WebApp.initData) {
                    log(`üîê initData –¥–æ—Å—Ç—É–ø–µ–Ω (–¥–ª–∏–Ω–∞: ${Telegram.WebApp.initData.length})`, 'success');
                } else {
                    log('‚ö†Ô∏è initData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
                }
                
                // –ö–†–ò–¢–ò–ß–ù–û: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebApp
                try {
                    Telegram.WebApp.ready();
                    log('‚úÖ Telegram.WebApp.ready() –≤—ã–∑–≤–∞–Ω', 'success');
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥
                    Telegram.WebApp.expand();
                    log('‚úÖ WebApp —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç', 'success');
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º MainButton
                    Telegram.WebApp.MainButton.text = "–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –û—Ç–ø—Ä–∞–≤–∏—Ç—å";
                    Telegram.WebApp.MainButton.color = "#ff6600";
                    Telegram.WebApp.MainButton.textColor = "#ffffff";
                    Telegram.WebApp.MainButton.show();
                    log('‚úÖ MainButton –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø–æ–∫–∞–∑–∞–Ω', 'success');
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ MainButton
                    Telegram.WebApp.MainButton.onClick(function() {
                        log('üîò MainButton –Ω–∞–∂–∞—Ç!', 'success');
                        testSendData();
                    });
                    
                    updateStatus('‚úÖ WebApp –≥–æ—Ç–æ–≤ –∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ', 'success');
                    
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                    updateStatus('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
                }
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        showTestData();
        
        // –§—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function testSendData() {
            log('üì§ === –ù–ê–ß–ò–ù–ê–ï–ú –¢–ï–°–¢ –û–¢–ü–†–ê–í–ö–ò –î–ê–ù–ù–´–• ===', 'info');
            
            try {
                const data = showTestData();
                
                log(`üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(data)}`, 'info');
                log(`üìè –†–∞–∑–º–µ—Ä JSON: ${JSON.stringify(data).length} —Å–∏–º–≤–æ–ª–æ–≤`, 'info');
                
                if (!window.Telegram || !window.Telegram.WebApp) {
                    throw new Error('Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                if (!window.Telegram.WebApp.sendData) {
                    throw new Error('Telegram.WebApp.sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                const jsonData = JSON.stringify(data);
                log(`üöÄ –í—ã–∑—ã–≤–∞–µ–º Telegram.WebApp.sendData()...`, 'info');
                
                window.Telegram.WebApp.sendData(jsonData);
                log('‚úÖ sendData() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                log('üì® –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±–æ—Ç–∞', 'success');
                
                // –°–∫—Ä—ã–≤–∞–µ–º MainButton
                window.Telegram.WebApp.MainButton.hide();
                log('‚úÖ MainButton —Å–∫—Ä—ã—Ç', 'success');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    log('üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...', 'info');
                    window.Telegram.WebApp.close();
                }, 3000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`, 'error');
                log(`‚ùå Stack trace: ${error.stack}`, 'error');
            }
        }
        
        function testMainButton() {
            log('üîò –¢–µ—Å—Ç–∏—Ä—É–µ–º MainButton...', 'info');
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.MainButton) {
                window.Telegram.WebApp.MainButton.show();
                log('‚úÖ MainButton –ø–æ–∫–∞–∑–∞–Ω', 'success');
            } else {
                log('‚ùå MainButton –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }
        
        function showDebugInfo() {
            log('üîç === DEBUG –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===', 'info');
            
            if (window.Telegram && window.Telegram.WebApp) {
                const wa = window.Telegram.WebApp;
                log(`üìä isExpanded: ${wa.isExpanded}`, 'info');
                log(`üìä viewportHeight: ${wa.viewportHeight}`, 'info');
                log(`üìä viewportStableHeight: ${wa.viewportStableHeight}`, 'info');
                log(`üìä headerColor: ${wa.headerColor}`, 'info');
                log(`üìä backgroundColor: ${wa.backgroundColor}`, 'info');
                log(`üìä isClosingConfirmationEnabled: ${wa.isClosingConfirmationEnabled}`, 'info');
                
                if (wa.MainButton) {
                    log(`üîò MainButton.isVisible: ${wa.MainButton.isVisible}`, 'info');
                    log(`üîò MainButton.isActive: ${wa.MainButton.isActive}`, 'info');
                    log(`üîò MainButton.text: ${wa.MainButton.text}`, 'info');
                }
            } else {
                log('‚ùå WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è debug', 'error');
            }
        }
        
        log('‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        log('üìã –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏', 'info');
    </script>
</body>
</html>
